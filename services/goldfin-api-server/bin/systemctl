#!/bin/bash
# Goldfin API Server
# Copyright (C) 2017 All rights reserved

##############################################################################
# ENVIRONMENT SETUP
##############################################################################

MAIN=io.goldfin.invoice.core.SystemCtl

# Find our home and cd to it. 
GBIN=`dirname $0`
GHOME=`cd $GBIN/..; pwd`
cd $GHOME

# Add jars from all directories to class path, which starts with 
# conf directory.
CP=conf
for jar in lib/*.jar; do 
  CP=$CP:$jar
done

# Find Java.
if [ -z "$JAVA_HOME" ]; then
  JAVA=`which java`
else
  JAVA=$JAVA_HOME/bin/java
fi
if [ ! -x "$JAVA" ]; then
  echo "Cannot find java command.  Please set the JAVA_HOME environment"
  echo "variable or add java to the execution path."
  exit 1
fi

# Set the platform charset if available.
if [ ! -z "$API_SERVER_FILE_ENCODING" ]; then
  JVM_OPTIONS="${JVM_OPTIONS} $API_SERVER_FILE_ENCODING"
fi

# Set log directory. 
if [ -z "$API_SERVER_LOG_DIR" ]; then 
  API_SERVER_LOG_DIR=$GHOME/log
fi
mkdir -p $API_SERVER_LOG_DIR
if [ ! -d "$API_SERVER_LOG_DIR" ]; then
  echo "Cannot find log directory: $API_SERVER_LOG_DIR"
  exit 1
fi
JVM_OPTIONS="${JVM_OPTIONS} -Dapi.server.log.dir=$API_SERVER_LOG_DIR" 

##############################################################################
# OPERATIONS
##############################################################################

# Run the CLI
$JAVA -cp $CP -Dlog4j.rootAppender=stdout -Dapi.server.home.dir=$GHOME $JVM_OPTIONS ${MAIN} $*
