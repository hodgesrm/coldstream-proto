<!--
  ~ Copyright (c) 2018 Goldfin.io. All Rights Reserved.
  -->
<clr-datagrid [(clrDgSelected)]="selected">
    <clr-dg-action-bar>
        <div class="btn-group">
            <button type="button" class="btn btn-primary" (click)="onInvoiceDetail()">Item Detail View</button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary" (click)="onResourceView()">Resource View</button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary" (click)="onValidate()">Validate</button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary" (click)="onDownload()">Download</button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary" (click)="onExportHeaders()">Export Headers</button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary" (click)="onExportDetails()">Export Details</button>
        </div>
        <div class="btn-group">
            <button type="button" class="btn btn-primary" (click)="onDelete()" >Delete</button>
        </div>
        <div class="btn-group">
            <button class="btn btn-link" (click)="onRefresh()" clrPosition="bottom-right">
                <clr-icon shape="refresh"></clr-icon>
            </button>
        </div>
    </clr-dg-action-bar>

    <clr-dg-column [clrDgField]="'identifier'">Identifier</clr-dg-column>
    <clr-dg-column [clrDgField]="'description'">
      <ng-container *clrDgHideableColumn="{hidden: true}">
        Description
      </ng-container>
    </clr-dg-column>
    <clr-dg-column [clrDgField]="'account'">Account</clr-dg-column>
    <clr-dg-column [clrDgField]="'effectiveDate'">Effective Date</clr-dg-column>
    <clr-dg-column [clrDgField]="'vendorIdentifier'">Vendor</clr-dg-column>
    <clr-dg-column [clrDgField]="'subtotalAmount'">Subtotal</clr-dg-column>
    <clr-dg-column [clrDgField]="'credit'">Credit</clr-dg-column>
    <clr-dg-column [clrDgField]="'tax'">Tax</clr-dg-column>
    <clr-dg-column [clrDgField]="'totalAmount'">Total</clr-dg-column>
    <clr-dg-column [clrDgField]="'currency'">Currency</clr-dg-column>

    <clr-dg-row *clrDgItems="let invoice of invoices" [clrDgItem]="invoice">
        <clr-dg-cell>{{invoice.identifier}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.description}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.account}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.effectiveDate}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.vendorIdentifier}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.subtotalAmount}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.credit}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.tax}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.totalAmount}}</clr-dg-cell>
        <clr-dg-cell>{{invoice.currency}}</clr-dg-cell>
    </clr-dg-row>

    <clr-dg-footer>{{invoices.length}} invoices</clr-dg-footer>
</clr-datagrid>

<clr-modal [(clrModalOpen)]="invoice_detail_open" [clrModalSize]="'xl'">
  <h3 class="modal-title">Invoice Line Item View</h3>
  <div class="modal-body">
    <clr-datagrid>
      <clr-dg-column [clrDgField]="'invoice_description'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Description
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_identifier'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Inv Identifier
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_account'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Account
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_effectiveDate'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Effective Date
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_vendorIdentifier'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Vendor
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_subtotalAmount'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Subtotal
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_credit'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Credit
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_tax'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Tax
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_totalAmount'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Total
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoice_currency'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Inv Currency
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'itemRowType'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Item Type
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'itemId'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Item ID
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'resourceId'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Resource ID
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'description'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Description
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'chargeType'">
        <ng-container *clrDgHideableColumn="{hidden: true}">
          Charge Type
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'unitAmount'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Unit Amount
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'units'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Units
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'unitType'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Unit Type
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'subtotalAmount'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Subtotal
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'credit'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Credit
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'tax'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Tax
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'totalAmount'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Total Amount
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'currency'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Currency
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'startDate'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Start Date
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'endDate'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          End Date
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'inventoryId'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Inventory ID
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'inventoryType'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Inventory Type
        </ng-container>
      </clr-dg-column>

      <clr-dg-row *clrDgItems="let item of invoice_items" [clrDgItem]="invoice_item">
        <clr-dg-cell>{{item.invoice_description}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_identifier}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_account}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_effectiveDate}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_vendorIdentifier}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_subtotalAmount}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_credit}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_tax}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_totalAmount}}</clr-dg-cell>
        <clr-dg-cell>{{item.invoice_currency}}</clr-dg-cell>
        <clr-dg-cell>{{item.itemRowType}}</clr-dg-cell>
        <clr-dg-cell>{{item.itemId}}</clr-dg-cell>
        <clr-dg-cell>{{item.resourceId}}</clr-dg-cell>
        <clr-dg-cell>{{truncateDisplayValue(item.description, 50)}}</clr-dg-cell>
        <clr-dg-cell>{{item.chargeType}}</clr-dg-cell>
        <clr-dg-cell>{{item.unitAmount}}</clr-dg-cell>
        <clr-dg-cell>{{item.units}}</clr-dg-cell>
        <clr-dg-cell>{{item.unitType}}</clr-dg-cell>
        <clr-dg-cell>{{item.subtotalAmount}}</clr-dg-cell>
        <clr-dg-cell>{{item.credit}}</clr-dg-cell>
        <clr-dg-cell>{{item.tax}}</clr-dg-cell>
        <clr-dg-cell>{{item.totalAmount}}</clr-dg-cell>
        <clr-dg-cell>{{item.currency}}</clr-dg-cell>
        <clr-dg-cell>{{item.startDate}}</clr-dg-cell>
        <clr-dg-cell>{{item.endDate}}</clr-dg-cell>
        <clr-dg-cell>{{item.inventoryId}}</clr-dg-cell>
        <clr-dg-cell>{{item.inventoryType}}</clr-dg-cell>
        <ng-container ngProjectAs="clr-dg-row-detail" 
             *ngIf="item.description.length > 50">
          <clr-dg-row-detail *clrIfExpanded>
            {{item.description}}
          </clr-dg-row-detail>
        </ng-container>
      </clr-dg-row>

      <clr-dg-footer>{{invoice_items.length}} invoice items</clr-dg-footer>
    </clr-datagrid>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="invoice_detail_open = false">Close</button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="resource_view_open" [clrModalSize]="'xl'">
  <h3 class="modal-title">Resource View</h3>
  <div class="modal-body">
    <clr-datagrid>
      <clr-dg-column [clrDgField]="'resourceId'">
        <ng-container>
          Resource ID
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'itemId'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Item ID
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'description'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Description
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'unitAmount'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Unit Amount
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'units'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Units
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'totalAmount'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Total Amount
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'currency'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Currency
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'startDate'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Start Date
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'endDate'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          End Date
        </ng-container>
      </clr-dg-column>

      <clr-dg-row *clrDgItems="let group of resource_items" [clrDgItem]="group">
        <clr-dg-cell>{{group.resourceId}}</clr-dg-cell>
        <clr-dg-cell>{{""}}</clr-dg-cell>
        <clr-dg-cell>{{""}}</clr-dg-cell>
        <clr-dg-cell>{{""}}</clr-dg-cell>
        <clr-dg-cell>{{""}}</clr-dg-cell>
        <clr-dg-cell>{{group.totalAmount}}</clr-dg-cell>
        <clr-dg-cell>{{""}}</clr-dg-cell>
        <clr-dg-cell>{{""}}</clr-dg-cell>
        <clr-dg-cell>{{""}}</clr-dg-cell>
        <ng-template ngFor let-item [ngForOf]="group.items" ngProjectAs="clr-dg-row-detail" *ngIf="true">
          <clr-dg-row-detail *clrIfExpanded>
            <clr-dg-cell>{{""}}</clr-dg-cell>
            <clr-dg-cell>{{item.itemId}}</clr-dg-cell>
            <clr-dg-cell>{{truncateDisplayValue(item.description, 50)}}</clr-dg-cell>
            <clr-dg-cell>{{item.unitAmount}}</clr-dg-cell>
            <clr-dg-cell>{{item.units}}</clr-dg-cell>
            <clr-dg-cell>{{item.totalAmount}}</clr-dg-cell>
            <clr-dg-cell>{{item.currency}}</clr-dg-cell>
            <clr-dg-cell>{{item.startDate}}</clr-dg-cell>
            <clr-dg-cell>{{item.endDate}}</clr-dg-cell>
          </clr-dg-row-detail>
        </ng-template>
      </clr-dg-row>

      <clr-dg-footer>{{resource_items.length}} resources</clr-dg-footer>
    </clr-datagrid>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="resource_view_open = false">Close</button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="invoice_validations_open" [clrModalSize]="'xl'">
  <h3 class="modal-title">Invoice Validations</h3>
  <div class="modal-body">
    <clr-datagrid>
      <clr-dg-column [clrDgField]="'passed'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Passed
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'summary'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Summary 
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'validationType'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Validation Type
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'details'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Details
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoiceId'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Invoice ID
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'identifier'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Identifier
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'effectiveDate'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Effective Date
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'vendorIdentifier'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Vendor Identifier
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoiceItemId'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Item ID
        </ng-container>
      </clr-dg-column>
      <clr-dg-column [clrDgField]="'invoiceItemResourceId'">
        <ng-container *clrDgHideableColumn="{hidden: false}">
          Item Resource ID
        </ng-container>
      </clr-dg-column>

      <clr-dg-row *clrDgItems="let result of filtered_validations" [clrDgItem]="validation_result">
        <clr-dg-cell>
          <span class={{getValidationResultClass(result.passed)}}>
            {{getValidationResultName(result.passed)}}
          </span>
        </clr-dg-cell>
        <clr-dg-cell>{{result.summary}}</clr-dg-cell>
        <clr-dg-cell>{{result.validationType}}</clr-dg-cell>
        <clr-dg-cell>{{result.details}}</clr-dg-cell>
        <clr-dg-cell>{{result.invoiceId}}</clr-dg-cell>
        <clr-dg-cell>{{result.identifier}}</clr-dg-cell>
        <clr-dg-cell>{{result.effectiveDate}}</clr-dg-cell>
        <clr-dg-cell>{{result.vendorIdentifier}}</clr-dg-cell>
        <clr-dg-cell>{{result.invoiceItemId}}</clr-dg-cell>
        <clr-dg-cell>{{result.invoiceItemResourceId}}</clr-dg-cell>
      </clr-dg-row>

      <clr-dg-footer>{{filtered_validations.length}} validation checks</clr-dg-footer>
    </clr-datagrid>
  </div>
  <div class="modal-footer">
    <section class="form-block">
      <div class="form-group">
        <div class="toggle-switch">
          <input type="checkbox" id="show_all_validations" 
            (change)="onValidationToggleChange($event)">
          <label for="show_all_validations">Show all validation results</label>
        </div>
      </div>
    </section>
    <button type="button" class="btn btn-outline" (click)="invoice_validations_open = false">Close</button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="delete_open">
  <h3 class="modal-title">Confirm Invoice Deletion</h3>
  <div class="modal-body">
    <p>Are you sure you want to delete the selected invoices? You will need to re-scan the corresponding documents to see them again.</p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-outline" (click)="delete_open = false">Cancel</button>
    <button type="button" class="btn btn-primary" (click)="onDeleteConfirmed()">Ok</button>
  </div>
</clr-modal>

<error-modal [reporter]="errorReporter"></error-modal>
