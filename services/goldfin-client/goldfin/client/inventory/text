# Copyright (c) 2018 Goldfin.  All rights reserved.

"""Leaseweb inventory analyzer"""

import json
import requests

from goldfin.client.api.models.observation import Observation

# Simplest possible script to read Leaseweb systems. 
servers_url = "https://api.leaseweb.com/bareMetals/v2/servers"
headers = {'X-Lsw-Auth': '2e3058e7-cc8f-45a3-9537-fba4f8d2b743'}
r = requests.get(servers_url, headers=headers)
if r.status_code != 200:
    raise Exception("Unable to login: {status_code}, {text}".format(
                    status_code=r.status_code, text=r.text))
r_as_json = r.json()
servers = r_as_json['servers']
#print(servers)
server_details = []
for server in servers:
    server_id = server['id']
    server_url = "{0}/{1}".format(servers_url, server_id)
    r2 = requests.get(server_url, headers=headers)
    #print("Server ID: {id}".format(id=server_id))
    #print(r2.status_code, r2.text)
    #print(json.dumps(r2.json(), indent=2))
    server_details.append(r2.json())

print(json.dumps(server_details, indent=2, sort_keys=True))
